<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% block title %}ì „ìê²°ì¬{% endblock %}</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial, sans-serif; margin:0; background:#f6f7fb; color:#111; }
    header { background:#111827; color:#fff; padding:14px 18px; }
    header a { color:#fff; text-decoration:none; }
    .wrap { max-width: 980px; margin: 0 auto; padding: 18px; }
    nav { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    nav .spacer { flex:1; }
    .card { background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:16px; box-shadow: 0 1px 2px rgba(0,0,0,0.04); }
    .grid { display:grid; gap:12px; }
    .grid-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
    /* âœ… ëª¨ë°”ì¼ì—ì„œ íŒ¨ë”©/ê¸€ì ì¡°ê¸ˆ ì¤„ì—¬ì„œ ë” ë³´ê¸° ì¢‹ê²Œ */
    @media (max-width: 640px) {
      .table th, .table td {
        padding: 8px 6px;
        font-size: 13px;
      }
    }
    .btn { display:inline-block; padding:10px 12px; border-radius:10px; border:1px solid #d1d5db; background:#fff; text-decoration:none; color:#111; font-size:14px; }
    .btn-primary { background:#2563eb; border-color:#2563eb; color:#fff; }
    .btn-danger { background:#dc2626; border-color:#dc2626; color:#fff; }
    .btn + .btn { margin-left: 6px; }
    .muted { color:#6b7280; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    /* âœ… í…Œì´ë¸”: ì—´ í­ ê³ ì • + ì¤„ë°”ê¿ˆ ë°©ì§€ + ë§ì¤„ì„ */
    .table {
      table-layout: fixed;
      width: 100%;
    }
    .table th, .table td {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      /* â­ ì¶”ê°€: 4ì—´ ì „ë¶€ ê°€ìš´ë° ì •ë ¬ */
      text-align: center;
    }

    /* ì œëª© ì—´ ë‚´ìš©(td)ë§Œ ì™¼ìª½ */
    .table td:nth-child(2) {
      text-align: left;
    }

    /* ì œëª© í—¤ë”(th)ëŠ” ê°€ìš´ë° ìœ ì§€ */
    .table th:nth-child(2) {
      text-align: center;
    }

    /* âœ… ëª¨ë°”ì¼ì—ì„œ í…Œì´ë¸” ê¹¨ì§ ë°©ì§€: ê°€ë¡œ ìŠ¤í¬ë¡¤ í—ˆìš© */
    .table-wrap {
      width: 100%;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
    .badge { display:inline-block; padding:4px 8px; border-radius:999px; font-size:12px; border:1px solid #e5e7eb; background:#f9fafb; }
    .row { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .field { margin: 10px 0; }
    label { display:block; font-weight:600; margin-bottom:6px; }
    input[type="text"], input[type="password"], textarea, select {
      width: 100%; box-sizing:border-box; padding:10px 12px; border-radius:10px;
      border:1px solid #d1d5db; background:#fff;
    }
    select[multiple] { min-height: 140px; }
    .help { font-size:12px; color:#6b7280; margin-top:6px; }
    .msg { padding:10px 12px; border-radius:10px; margin: 0 0 12px 0; border:1px solid #e5e7eb; background:#fff; }
    .msg.success { border-color:#86efac; background:#f0fdf4; }
    .msg.error { border-color:#fecaca; background:#fef2f2; }
    footer { padding: 20px 0; color:#6b7280; font-size:12px; }
    /* ===== í”„ë¡œí•„ íŒì˜¤ë²„ ===== */
    .profile-wrap { display:flex; align-items:center; gap:10px; position:relative; }

    .profile-btn {
      border:0;
      background:transparent;
      cursor:pointer;
      padding:0;
      line-height:0;
    }

    .profile-avatar{
      width:34px; height:34px;
      border-radius:999px;
      display:flex; align-items:center; justify-content:center;
      background:#ffffff1a;
      border:1px solid rgba(255,255,255,0.25);
      color:#fff;
      font-weight:800;
    }

    .profile-popover{
      position:absolute;
      right:0;
      top:44px;
      width:260px;
      background:#fff;
      border:1px solid #e5e7eb;
      border-radius:14px;
      box-shadow: 0 10px 24px rgba(0,0,0,0.12);
      padding:12px;
      display:none;
      z-index:9999;
    }

    .profile-popover.open{ display:block; }

    .profile-popover-title{
      font-weight:800;
      margin-bottom:10px;
    }

    .profile-row{
      display:grid;
      grid-template-columns: 64px 1fr;
      gap:10px;
      padding:8px 0;
      border-top:1px solid #f1f5f9;
    }

    .profile-row:first-of-type{ border-top:0; }

    .profile-label{ color:#6b7280; font-size:12px; }
    .profile-value{ color:#111; font-size:13px; word-break:break-word; }

    .profile-actions{ margin-top:10px; display:flex; gap:8px; }

    /* =======================================================
   ğŸ“±MOBILE CARD LAYOUT (doc list)
    PC = ê¸°ì¡´ í…Œì´ë¸” ìœ ì§€
    MOBILE = ì¹´ë“œí˜• ìë™ ë³€í™˜
    ======================================================= */
    @media (max-width: 768px){

    /* í…Œì´ë¸” êµ¬ì¡°ë¥¼ ì¹´ë“œì²˜ëŸ¼ ë³€í™˜ */
    .doc-table,
    .doc-table thead,
    .doc-table tbody,
    .doc-table th,
    .doc-table td,
    .doc-table tr{
      display:block;
      width:100%;
    }

    /* í—¤ë” ìˆ¨ê¹€ (ëª¨ë°”ì¼ì—ì„œëŠ” ë¶ˆí•„ìš”) */
    .doc-table thead{
      display:none;
    }

    /* ì¹´ë“œ í•˜ë‚˜ */
    .doc-table tr{
      background:#fff;
      border:1px solid #e5e7eb;
      border-radius:14px;
      padding:10px 12px;
      margin-bottom:10px;
      box-shadow:0 1px 3px rgba(0,0,0,0.04);
    }

    /* td ê¸°ë³¸ ë¦¬ì…‹ */
    .doc-table td{
      border:none;
      padding:4px 0;
      text-align:left !important;
      white-space:normal;
    }

    /* ===== 1ì¤„: ìƒíƒœ ===== */
    .doc-table td:nth-child(1){
      font-size:12px;
      font-weight:600;
      color:#2563eb;
      margin-bottom:4px;
    }

    /* ===== 2ì¤„: ì œëª© (ê°€ì¥ í¬ê²Œ) ===== */
    .doc-table td:nth-child(2){
      font-size:15px;
      font-weight:700;
      margin-bottom:8px;
      line-height:1.4;
    }

    /* ===== 3ì¤„: ì‘ì„±ì + ìˆ˜ì • (ê°€ë¡œ ì •ë ¬) ===== */
    .doc-table td:nth-child(3),
    .doc-table td:nth-child(4){
      display:inline-block;
      font-size:12px;
      color:#6b7280;
      margin-right:12px;
    }

    /* ì‘ì„±ì ì• ë¼ë²¨ */
    .doc-table td:nth-child(3)::before{
      content:"ì‘ì„±ì ";
      font-weight:600;
      color:#374151;
    }

    /* ìˆ˜ì • ì• ë¼ë²¨ */
    .doc-table td:nth-child(4)::before{
      content:"ìˆ˜ì • ";
      font-weight:600;
      color:#374151;
    }
  }

  /* ==========================
   âœ… Dashboard (Mobile polish)
   ========================== */

  /* ë°ìŠ¤í¬íƒ‘: 3ì¹¸ ìœ ì§€ */
  .dash-grid{
    display:grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap:12px;
  }

  .dash-card{
    background:#fff;
    border:1px solid #e5e7eb;
    border-radius:14px;
    padding:16px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.04);
    display:flex;
    flex-direction:column;
    gap:10px;
  }

  .dash-label{
    color:#6b7280;
    font-size:13px;
    font-weight:600;
  }

  .dash-num{
    font-size:30px;
    font-weight:900;
    line-height:1;
  }

  .dash-btn{
    width:100%;
    text-align:center;
    margin-top:auto; /* ë²„íŠ¼ì„ ì¹´ë“œ í•˜ë‹¨ìœ¼ë¡œ */
  }

  .dash-create-btn{
    width:100%;
    text-align:center;
  }

  /* ëª¨ë°”ì¼: 1ì—´ + ê°€ìš´ë° ì •ë ¬ + í„°ì¹˜ ì¹œí™” */
  @media (max-width: 768px){
    .wrap{ padding:14px; }         /* ëª¨ë°”ì¼ ì—¬ë°± ì¡°ê¸ˆ ì¤„ì´ê¸° */
    .dash-grid{
      grid-template-columns: 1fr;  /* 1ì—´ */
      gap:10px;
    }
    .dash-card{
      padding:14px;
      align-items:center;          /* ì¹´ë“œ ë‚´ë¶€ ê°€ìš´ë° ì •ë ¬ */
      text-align:center;
    }
    .dash-label{
      font-size:13px;
    }
    .dash-num{
      font-size:34px;              /* ìˆ«ì ê°•ì¡° */
    }
    .dash-btn, .dash-create-btn{
      padding:12px 12px;           /* í„°ì¹˜ ì˜ì—­ í™•ëŒ€ */
      border-radius:12px;
    }
  }
  </style>
</head>

<body>
  <header>
    <div class="wrap">
      <nav>
        <a href="{% url 'approvals:home' %}"><strong>ì „ìê²°ì¬</strong></a>
        <a class="btn" href="{% url 'approvals:doc_list' %}">ë‚´ ë¬¸ì„œí•¨</a>
        <a class="btn" href="{% url 'approvals:inbox' %}">ê²°ì¬í•¨</a>

        <!-- âœ… received ë§í¬ í†µì¼: approvals:received -->
        <a class="btn" href="{% url 'approvals:received' %}">ìˆ˜ì‹ í•¨</a>

        <a class="btn btn-primary" href="{% url 'approvals:doc_create' %}">ë¬¸ì„œ ìƒì‹ </a>

        <span class="spacer"></span>

        {% if user.is_authenticated %}
          <div class="profile-wrap">
  <span class="muted">ì•ˆë…•í•˜ì„¸ìš”, <strong>{{ user.username }}</strong>ë‹˜</span>

  <!-- âœ… í”„ë¡œí•„ ì•„ì´ì½˜ ë²„íŠ¼ -->
  <button type="button" class="profile-btn" id="profileBtn" aria-haspopup="true" aria-expanded="false">
    <span class="profile-avatar">
      {{ user.profile.display_name|default:user.username|slice:":1" }}
    </span>
  </button>

  <!-- âœ… ë“œë¡­ë‹¤ìš´(íŒì˜¤ë²„) -->
  <div class="profile-popover" id="profilePopover" role="menu" aria-labelledby="profileBtn">
    <div class="profile-popover-title">ë‚´ í”„ë¡œí•„</div>

    <div class="profile-row">
      <div class="profile-label">ì´ë¦„</div>
      <div class="profile-value">
        {{ user.profile.full_name|default:user.first_name|default:user.username }}
      </div>
    </div>

    <div class="profile-row">
      <div class="profile-label">ì „í™”</div>
      <div class="profile-value">
        {{ user.profile.phone|default:"-" }}
      </div>
    </div>

    <div class="profile-row">
      <div class="profile-label">ì´ë©”ì¼</div>
      <div class="profile-value">
        {{ user.email|default:"-" }}
      </div>
    </div>
  </div>

    </div>
          <!-- âœ… ì¶”ê°€: ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ -->
          <a class="btn" href="{% url 'accounts:password_change' %}">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</a>

          <form method="post" action="{% url 'accounts:logout' %}" style="display:inline;">
            {% csrf_token %}
            <button class="btn" type="submit">ë¡œê·¸ì•„ì›ƒ</button>
          </form>
        {% else %}
          <a class="btn" href="{% url 'accounts:login' %}">ë¡œê·¸ì¸</a>
          <a class="btn btn-primary" href="{% url 'accounts:signup' %}">íšŒì›ê°€ì…</a>
        {% endif %}
      </nav>
    </div>
  </header>

  <main class="wrap">
    {% if messages %}
      {% for message in messages %}
        <div class="msg {% if message.tags %}{{ message.tags }}{% endif %}">
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}

    {% block content %}{% endblock %}

    <footer class="muted">
      <div>Â© eApproval</div>
    </footer>
  </main>

  <script>
  (function () {
    const btn = document.getElementById("profileBtn");
    const pop = document.getElementById("profilePopover");
    if (!btn || !pop) return;

    function open() {
      pop.classList.add("open");
      btn.setAttribute("aria-expanded", "true");
    }
    function close() {
      pop.classList.remove("open");
      btn.setAttribute("aria-expanded", "false");
    }
    function toggle() {
      pop.classList.contains("open") ? close() : open();
    }

    btn.addEventListener("click", function (e) {
      e.preventDefault();
      e.stopPropagation();
      toggle();
    });

    pop.addEventListener("click", function (e) {
      // íŒì˜¤ë²„ ì•ˆ í´ë¦­ì€ ë‹«íˆì§€ ì•Šê²Œ
      e.stopPropagation();
    });

    document.addEventListener("click", function () {
      close();
    });

    document.addEventListener("keydown", function (e) {
      if (e.key === "Escape") close();
    });
  })();
  </script>

</body>
</html>